<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/addDark.css') }}">
    <title>Add Game Record</title>
</head>
<body>
    {% extends "base.html" %}
    {% import "bootstrap/wtf.html" as wtf %}
    {% block content %}

    <div id="content">
        <div class="card" onclick="createPopup('Dominion', 4)">
            <div class="img">
                <img src="/static/images/addgame/dominion.png">
            </div>
            <div class="text">
                <p style="font-size: 24px;">Dominion</p>
                <p style="font-size: large;">2 - 4 Players</p>
                <div>
                    <span class="bottom">Add a</span>&nbsp;<span class="bottom" style="text-decoration: underline;">game</span>
                </div>
            </div>
        </div>

        <div class="card" onclick="createPopup('Catan', 4)">
            <div class="img">
                <img src="/static/images/addgame/catan.png">
            </div>
            <div class="text">
                <p style="font-size: 24px;">Catan</p>
                <p style="font-size: large;">2 - 4 Players</p>
                <div>
                    <span class="bottom">Add a</span>&nbsp;<span class="bottom" style="text-decoration: underline;">game</span>
                </div>
            </div>
        </div>

        <div class="card" onclick="createPopup('Moonrakers', 5)">
            <div class="img">
                <img src="/static/images/addgame/moonrakers.jpg">
            </div>
            <div class="text">
                <p style="font-size: 24px;">Moonrakers</p>
                <p style="font-size: large;">1 - 5 Players</p>
                <div style="margin-top: 7px;">
                    <span class="bottom">Add a</span>&nbsp;<span class="bottom" style="text-decoration: underline;">game</span>
                </div>
            </div>
        </div>

        <div class="card" onclick="createPopup('Lords of Waterdeep', 5)">
            <div class="img">
                <img src="/static/images/addgame/lordsofwaterdeep.png">
            </div>
            <div class="text">
                <p style="font-size: 24px;">Lords of Waterdeep</p>
                <p style="font-size: large;">3 - 5 Players</p>
                <div>
                    <span class="bottom">Add a</span>&nbsp;<span class="bottom" style="text-decoration: underline;">game</span>
                </div>
            </div>
        </div>

        <div class="card" onclick="createPopup('Cosmic Encounter', 5)">
            <div class="img">
                <img src="/static/images/addgame/CosmicEncounter.png">
            </div>
            <div class="text">
                <p style="font-size: 24px;">Cosmic Encounter</p>
                <p style="font-size: large;">3 - 5 Players</p>
                <div>
                    <span class="bottom">Add a</span>&nbsp;<span class="bottom" style="text-decoration: underline;">game</span>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="img">
                <img src="/static/images/addgame/loveletter.jpg">
            </div>
            <div class="text">
                <p style="font-size: 24px;">Love Letter</p>
                <p style="font-size: large;">3 - 5 Players</p>
                <div>
                    <span class="bottom">Add a</span>&nbsp;<span class="bottom" style="text-decoration: underline;">game</span>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="img">
                <img src="/static/images/addgame/themind.png">
            </div>
            <div class="text">
                <p style="font-size: 24px;">The Mind</p>
                <p style="font-size: large;">2 - 4 Players</p>
                <div>
                    <span class="bottom">Add a</span>&nbsp;<span class="bottom" style="text-decoration: underline;">game</span>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="img">
                <img src="/static/images/addgame/pandemic.jpg">
            </div>
            <div class="text">
                <p style="font-size: 24px;">Pandemic</p>
                <p style="font-size: large;">2 - 4 Players</p>
                <div>
                    <span class="bottom">Add a</span>&nbsp;<span class="bottom" style="text-decoration: underline;">game</span>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="img">
                <img src="/static/images/addgame/coup.jpg">
            </div>
            <div class="text">
                <p style="font-size: 24px;">Coup</p>
                <p style="font-size: large;">4 - 8 Players</p>
                <div>
                    <span class="bottom">Add a</span>&nbsp;<span class="bottom" style="text-decoration: underline;">game</span>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="img">
                <img src="/static/images/addgame/codenames.jpg">
            </div>
            <div class="text">
                <p style="font-size: 24px;">Codenames</p>
                <p style="font-size: large;">4 - 10 Players</p>
                <div>
                    <span class="bottom">Add a</span>&nbsp;<span class="bottom" style="text-decoration: underline;">game</span>
                </div>
            </div>
        </div>

        <div class="card" onclick="createPopup('Here to Slay', 6)">
            <div class="img">
                <img src="/static/images/addgame/heretoslay.jpg">
            </div>
            <div class="text">
                <p style="font-size: 24px;">Here to Slay</p>
                <p style="font-size: large;">2 - 6 Players</p>
                <div>
                    <span class="bottom">Add a</span>&nbsp;<span class="bottom" style="text-decoration: underline;">game</span>
                </div>
            </div>
        </div>

        <div class="card" onclick="createPopup('Munchkin', 6)">
            <div class="img">
                <img src="/static/images/addgame/munchkin.jpg">
            </div>
            <div class="text">
                <p style="font-size: 24px;">Munchkin</p>
                <p style="font-size: large;">3 - 6 Players</p>
                <div>
                    <span class="bottom">Add a</span>&nbsp;<span class="bottom" style="text-decoration: underline;">game</span>
                </div>
            </div>
        </div>

    </div>
    <div id="overlay" class="Hide"> </div>

    <div id="popups"> </div>

    <script>
        function createPopup(game, maxLength){
            overlay.classList.remove("Hide");
            // Create the main div
            const Popup = document.createElement('div');
            Popup.id = 'Popup';
            Popup.classList.add('gamepopup');

            if(maxLength == 4){
                Popup.style.height = '415px';
            } else if (maxLength == 5) {
                Popup.style.height = '490px';
            } else if (maxLength == 6) {
                Popup.style.height = '565px';
            }

            // Create the close button
            const closeButton = document.createElement('p');
            closeButton.classList.add('close-button');
            closeButton.textContent = 'x';
            Popup.appendChild(closeButton);

            // Create the heading
            const heading = document.createElement('h2');
            heading.style.color = 'white';
            heading.textContent = `Add ${game} Record`;
            Popup.appendChild(heading);

            // Create the form
            const form = document.createElement('form');
            if (game == 'Dominion') {
                form.action = `{{ url_for('addDominion') }}`;
            } else if (game == 'Catan') {
                form.action = `{{ url_for('addCatan') }}`;
            } else if (game == 'Lords of Waterdeep') {
                form.action = `{{ url_for('addLordsofWaterdeep') }}`;
            } else if (game == 'Moonrakers') {
                form.action = `{{ url_for('addMoonrakers') }}`;
            }

            form.method = "POST";
            form.autocomplete = "off";
            form.style = "margin-top: 10px !important;"

            const labels = ["Winner", "Runner Up", "Third Place", "Fourth Place", "Fifth Place", "Sixth Place"];
            const games = ["dominion" , "catan", "moonrakers", "lordsofwaterdeep", "cosmicencounter"];
            const gamelength = [4, 4, 5, 5, 5];
            // ... (Create and append other elements as per the provided HTML structure)
            for(let i = 1; i < maxLength + 1; i++) {
                //creating players div to organize the inputs
                let div = document.createElement('div');
                div.classList.add('players');
                //creating the first label and name input
                let playersecion = document.createElement('div');
                playersecion.classList.add('playerSection');
                const label = document.createElement('label');
                label.htmlFor = `Player${i}`;
                label.textContent = labels[i - 1];
                const input = document.createElement('input');
                input.type = 'text';
                input.id = `Player${i}`;
                input.name = `Player${i}`;
                input.placeholder = 'Name';
                input.addEventListener('keyup', function() {
                    showResults(this.value, this.id);
                });
                playersecion.appendChild(label);
                playersecion.appendChild(input);   
                //creating the second label and score input
                let playersecion2 = document.createElement('div');
                playersecion2.classList.add('playerSection');
                const label2 = document.createElement('label');
                label2.htmlFor = `Score${i}`;
                label2.textContent = 'Score';
                const input2 = document.createElement('input');
                input2.type = 'text';
                input2.id = `Score${i}`;
                input2.name = `Score${i}`;
                input2.placeholder = 'Score';
                playersecion2.appendChild(label2);
                playersecion2.appendChild(input2);
                //adding them all
                div.appendChild(playersecion);
                div.appendChild(playersecion2);
                form.appendChild(div);
            }

            let button = document.createElement('button');
            button.style = "margin-top: 10px";
            button.classList.add('btn');
            button.classList.add('btn-primary');
            button.innerText = 'Submit Record';

            form.appendChild(button);
            // Finally, append the form to the main div
            Popup.appendChild(form);

            // Add the dominionPopup to the document body or any other desired parent element
            document.body.appendChild(Popup);
        }
        
        let cards = document.querySelectorAll(".card");
        let gamepopups = document.querySelectorAll(".gamepopup");
        let closebuttons = document.querySelectorAll(".close-button");
        let overlay = document.querySelector("#overlay");

        // for (let i = 0; i < gamepopups.length; i++) {
        //     cards[i].addEventListener('click', () => {
        //         for (let j = 0; j < gamepopups.length; j++){
        //             gamepopups[j].classList.add("Hide");
        //         }
        //         gamepopups[i].classList.remove("Hide");
        //         overlay.classList.remove("Hide");
        //     })
        //     closebuttons[i].addEventListener('click', () => {
        //         gamepopups[i].classList.add("Hide");
        //         overlay.classList.add("Hide");
        //     })
        // }

        overlay.addEventListener('click', () => {
            overlay.classList.add("Hide");
            Popup = document.querySelector("#Popup");
            // for (let j = 0; j < gamepopups.length; j++){
            //     gamepopups[j].classList.add("Hide");
            // }
            Popup.remove();
        })

        fetch('/returnFriends')
        .then(response => response.json())
        .then(data => {
            search_terms = data;
            console.log(search_terms);
        })
        .catch(error => console.error(error));

        function autocompleteMatch(input) {
            if (input == '') {
                return [];
            }
            var reg = new RegExp(input,'i')
            return search_terms.filter(function(term) {
                if (term.match(reg)) {
                return term;
                }
            });
            }

            function showResults(val, id) {
            let parts = id.split(/(\d+)/);
            let part = parts[0];
            let gameName = part.slice(0, -6);
            console.log("GAME");
            console.log(gameName);
            let index = id.search(/\d/);
            let num = id.substring(index);
            console.log(num);
            results = document.querySelectorAll(`.${gameName}results`);
            results[num - 1].classList.remove("Hide");
            let res = results[num - 1]
            res.innerHTML = '';
            let list = '';
            if (val === '') {
                res.classList.add("Hide");
                return;
            }
            let terms = autocompleteMatch(val);
            for (i=0; i<terms.length; i++) {
                list += '<li>' + terms[i] + '</li>';
            }
            res.innerHTML = '<ul>' + list + '</ul>';

            // Add event listener to each li element
            let liElements = document.querySelectorAll(`.${gameName}results li`);
            liElements.forEach(function(li) {
                li.addEventListener('click', function() {
                    document.querySelector(`#${gameName}Player${num}`).value = li.innerText;
                    res.innerHTML = '';
                    res.classList.add("Hide");
                });
            });

            document.addEventListener('click', function(event) {
                if (!event.target.closest(`#${gameName}Player${num}`) && !event.target.closest(`.${gameName}results`)) {
                    res.classList.add("Hide");
                }
            });

        }

    </script>
    {% endblock %}
</body>
</html>